<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ Demand/SWAT</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ Demand/SWAT</h1>
            <p class="subtitle">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
        </header>

        <div class="rules-section">
            <h2>üìù –ü—Ä–∞–≤–∏–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤</h2>
            <div class="rules-grid">
                <div class="rule-card">
                    <div class="rule-number">1</div>
                    <h3>–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ</h3>
                    <p>–°–Ω–∞—á–∞–ª–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π</p>
                </div>
                <div class="rule-card">
                    <div class="rule-number">2</div>
                    <h3>–î–∏–∞–ø–∞–∑–æ–Ω 0.96-1.04</h3>
                    <p>–ó–Ω–∞—á–µ–Ω–∏—è –æ—Ç 0.96 –¥–æ 1.04 –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ 1.00</p>
                </div>
                <div class="rule-card">
                    <div class="rule-number">3</div>
                    <h3>–ú–∏–Ω–∏–º—É–º 0.8</h3>
                    <p>–ó–Ω–∞—á–µ–Ω–∏—è &lt; 0.8 –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ 0.80</p>
                </div>
                <div class="rule-card">
                    <div class="rule-number">4</div>
                    <h3>–ú–∞–∫—Å–∏–º—É–º 1.5</h3>
                    <p>–ó–Ω–∞—á–µ–Ω–∏—è &gt; 1.5 –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ 1.50</p>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <h2>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h2>
            
            <div class="file-types">
                <div class="file-type">
                    <h3>–§–∞–π–ª—ã DEMAND</h3>
                    <p>CSV —Ñ–∞–π–ª—ã —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Å–ø—Ä–æ—Å–∞</p>
                    <p class="example-link">
                        <a href="https://datalens.yandex-team.ru/3lf9drlr6acqt-demand-prediction-2-0?tab=jKa&state=f258f86c1287" target="_blank">
                            üìã –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞ DEMAND
                        </a>
                    </p>
                    <div class="file-upload-area" id="demandUploadArea">
                        <input type="file" id="demandFiles" accept=".csv" multiple style="display: none;">
                        <div class="upload-placeholder">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã DEMAND —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                        </div>
                        <div class="file-list" id="demandFileList"></div>
                    </div>
                    <button class="btn-secondary" onclick="document.getElementById('demandFiles').click()">
                        –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã DEMAND
                    </button>
                </div>

                <div class="file-type">
                    <h3>–§–∞–π–ª—ã SWAT</h3>
                    <p>CSV —Ñ–∞–π–ª—ã —Å –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ SWAT</p>
                    <p class="example-link">
                        <a href="https://datalens.yandex-team.ru/3lf9drlr6acqt-demand-prediction-2-0?tab=jKa&state=81d9908b1227" target="_blank">
                            üìã –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞ SWAT
                        </a>
                    </p>
                    <div class="file-upload-area" id="swatUploadArea">
                        <input type="file" id="swatFiles" accept=".csv" multiple style="display: none;">
                        <div class="upload-placeholder">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã SWAT —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                        </div>
                        <div class="file-list" id="swatFileList"></div>
                    </div>
                    <button class="btn-secondary" onclick="document.getElementById('swatFiles').click()">
                        –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã SWAT
                    </button>
                </div>
            </div>
        </div>

        <div class="options-section">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á–µ—Ç–∞</h2>
            <div class="options-grid">
                <div class="option">
                    <label>
                        <input type="checkbox" id="includeExamples" checked>
                        –í–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="checkbox" id="autoDownload" checked>
                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    </label>
                </div>
            </div>
        </div>

        <div class="calculate-section">
            <button class="btn-primary" id="calculateBtn" onclick="calculateCoefficients()" disabled>
                <span class="btn-text">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã</span>
                <span class="spinner" style="display: none;"></span>
            </button>
            <p class="hint">–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –ø–æ –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞</p>
        </div>

        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="coeff100">0</div>
                    <div class="stat-label">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç = 1.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="coeff08">0</div>
                    <div class="stat-label">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç = 0.80</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="coeff15">0</div>
                    <div class="stat-label">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç = 1.50</div>
                </div>
            </div>

            <div class="preview-table">
                <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–æ–∫)</h3>
                <div class="table-container">
                    <table id="previewTable">
                        <thead>
                            <tr>
                                <th>Product ID</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ö–æ—ç—Ñ. raw</th>
                                <th>–ö–æ—ç—Ñ. adj</th>
                                <th>Demand</th>
                                <th>SWAT</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="actions">
                <button class="btn-success" onclick="downloadExcel()">
                    üì• –°–∫–∞—á–∞—Ç—å Excel —Ñ–∞–π–ª
                </button>
                <button class="btn-secondary" onclick="showDetails()">
                    üìä –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                </button>
            </div>
        </div>

        <div class="info-section">
            <h2>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div class="info-grid">
                <div class="info-item">
                    <h3>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã</h3>
                    <p>CSV —Ñ–∞–π–ª—ã —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º ";" –∏ –¥–µ—Å—è—Ç–∏—á–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º ","</p>
                </div>
                <div class="info-item">
                    <h3>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</h3>
                    <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 10MB, –º–∞–∫—Å–∏–º—É–º —Ñ–∞–π–ª–æ–≤: 10 –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞</p>
                </div>
                <div class="info-item">
                    <h3>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</h3>
                    <p>–í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –§–∞–π–ª—ã –Ω–∏–∫—É–¥–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ -->
    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="detailedStats"></div>
            </div>
        </div>
    </div>

    <!-- –î–µ–±–∞–≥ –∫–Ω–æ–ø–∫–∞ -->
    <div style="position: fixed; bottom: 10px; right: 10px; z-index: 1000;">
        <button onclick="debugFiles()" style="background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px;">
            Debug
        </button>
    </div>

    <script src="script.js"></script>
    <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–±–∞–≥–∞
    <script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–±–∞–≥–∞
function debugFiles() {
    console.clear();
    console.log('=== –î–ï–¢–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –§–ê–ô–õ–ê–• ===');
    
    if (demandFiles.length > 0) {
        console.log('\n--- DEMAND —Ñ–∞–π–ª—ã ---');
        demandFiles.forEach((file, i) => {
            console.log(`${i + 1}. ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
            analyzeFileStructure(file);
        });
    } else {
        console.log('–ù–µ—Ç DEMAND —Ñ–∞–π–ª–æ–≤');
    }
    
    if (swatFiles.length > 0) {
        console.log('\n--- SWAT —Ñ–∞–π–ª—ã ---');
        swatFiles.forEach((file, i) => {
            console.log(`${i + 1}. ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
            analyzeFileStructure(file);
        });
    } else {
        console.log('–ù–µ—Ç SWAT —Ñ–∞–π–ª–æ–≤');
    }
    
    // –ü–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
    console.log('\n=== –¢–ï–°–¢–û–í–û–ï –ß–¢–ï–ù–ò–ï –§–ê–ô–õ–û–í ===');
    
    if (demandFiles.length > 0) {
        const testReader = new FileReader();
        testReader.onload = function(e) {
            console.log('\n--- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ DEMAND —Ñ–∞–π–ª–∞ ---');
            const text = e.target.result;
            const lines = text.split('\n');
            console.log('–ü–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–æ–∫ DEMAND —Ñ–∞–π–ª–∞:');
            lines.slice(0, 10).forEach((line, i) => {
                console.log(`${i}: ${line}`);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
            const firstLine = lines[0] || '';
            const secondLine = lines[1] || '';
            console.log('\n–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã DEMAND:');
            console.log('–î–ª–∏–Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏:', firstLine.length);
            console.log('–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ";" –Ω–∞–π–¥–µ–Ω–æ:', (firstLine.match(/;/g) || []).length);
            console.log('–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å "," –Ω–∞–π–¥–µ–Ω–æ:', (firstLine.match(/,/g) || []).length);
            console.log('–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å "\t" –Ω–∞–π–¥–µ–Ω–æ:', (firstLine.match(/\t/g) || []).length);
        };
        testReader.readAsText(demandFiles[0]);
    }
}
</script>
    }
    </script>
</body>
</html>

